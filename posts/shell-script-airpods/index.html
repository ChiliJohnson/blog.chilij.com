<!doctype html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-162787046-2"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-162787046-2');</script><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Connecting to your AirPods with a shell script (and keyboard shortcut) | Chili J</title><meta name="description" content="Pretty much anything"><meta name="robots" content="index,follow"><meta name="generator" content="Eleventy"><meta name="subject" content="Pretty much anything"><meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://blog.chilij.com/posts/shell-script-airpods/"><meta name="twitter:title" content="Connecting to your AirPods with a shell script (and keyboard shortcut)"><meta name="twitter:description" content="How you can connect to your AirPods programmatically, using a few shell commands and optionally a keyboard shortcut"><link rel="author" href="https://blog.chilij.com"><link rel="publisher" href="https://blog.chilij.com"><meta itemprop="name" content="Connecting to your AirPods with a shell script (and keyboard shortcut)"><meta itemprop="description" content="How you can connect to your AirPods programmatically, using a few shell commands and optionally a keyboard shortcut"><meta property="og:url" content="https://blog.chilij.com/posts/shell-script-airpods/"><meta property="og:type" content="website"><meta property="og:title" content="Connecting to your AirPods with a shell script (and keyboard shortcut)"><meta property="og:description" content="How you can connect to your AirPods programmatically, using a few shell commands and optionally a keyboard shortcut"><meta property="og:site_name" content="Chili J"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://blog.chilij.com/images/og-lambda.png"><meta property="article:author" content="https://blog.chilij.com"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.css"><link href="http://fonts.googleapis.com/css?family=Lato:300,400,700|Droid+Serif:400,700|Pacifico" rel="stylesheet" type="text/css"><link rel="stylesheet" href="https://use.typekit.net/ooa0ozr.css"><style>code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Consolas,"Bitstream Vera Sans Mono","Courier New",Courier,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:.9em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre>code[class*=language-]{font-size:1em}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:1px solid #ddd;background-color:#fff}:not(pre)>code[class*=language-]{padding:.2em;padding-top:1px;padding-bottom:1px;background:#f8f8f8;border:1px solid #ddd}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998;font-style:italic}.token.namespace{opacity:.7}.token.attr-value,.token.string{color:#e3116c}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.entity,.token.inserted,.token.number,.token.property,.token.regex,.token.symbol,.token.url,.token.variable{color:#36acaa}.language-autohotkey .token.selector,.token.atrule,.token.attr-name,.token.keyword{color:#00a4db}.language-autohotkey .token.tag,.token.deleted,.token.function{color:#9a050f}.language-autohotkey .token.keyword,.token.selector,.token.tag{color:#00009f}.token.bold,.token.function,.token.important{font-weight:700}.token.italic{font-style:italic}h1,h2,h3,h4,h5,h6{text-rendering:optimizeLegibility;line-height:1;margin-top:0;font-family:cholla-slab,serif;font-weight:700}h1{font-size:2em;line-height:1.2em;letter-spacing:-2px;text-indent:-3px}h2{font-size:1.7em;line-height:1.2em;letter-spacing:-1px;text-indent:-2px}h3{font-size:1.5em}h4{font-size:1.3em}h5{font-size:1.1em}h6{font-size:1em}.post-content h1,.post-content h2,.post-content h3,.post-content h4,.post-content h5,.post-content h6{margin-top:1.4em;margin-bottom:.8em}.post-template .post-meta,.post-template .post-title{text-align:center}.post-template .post-title{margin:.8em}figure{margin:0;padding:2em 0}figure img{width:100%}body{display:flex;flex-direction:column;align-items:center;min-height:100vh;font-family:letter-gothic-std,monospace;font-size:1.2rem;line-height:1.6em;color:#2c3237;letter-spacing:-.03em;font-weight:400}header#site-head,nav#main-nav{padding:0 16px;flex-basis:80%;max-width:680px;flex-grow:0;flex-shrink:0}.post-title span,a{text-decoration:none;background-color:#2c3237;color:#fff}#site-head{margin:3.3em 0}#blog-logo{background-color:transparent}#blog-logo img{min-width:5.5em;height:auto}.main-nav ul{list-style:none;display:flex;padding:0;margin:0;justify-content:center}.main-nav li{margin:1em}article{display:flex;flex-direction:column;max-width:42rem;margin:0 1.25em;padding:1.6em 0}article footer,article header,article section{flex:0 0 auto}article header{margin:0}article header h1,article header h2,article header h3,article header h4,article header h5,article header h6{margin:0}article p,article pre{margin:1.6em 0 0 0}article section.post-excerpt p{margin:.5em 0 0 0}blockquote{text-align:center;border:1px solid #c3c3c3;margin:2em 0}blockquote p{margin:0;padding:0}pre{font-size:.8em!important;line-height:1.6em!important;overflow:auto!important;background-color:#f7f7f7!important;border:1px solid #eee!important}blockquote,pre{padding:1em 1.4em!important}.post-meta{list-style:none;color:#c3c3c3;font-size:.8em;margin:.2em 0;padding:0}main{margin-bottom:3em;max-width:100%}@media (max-width:42rem){body{font-size:1rem}}.direct-link{background:0 0;font-size:.7em;opacity:.2;transition:opacity .2s}.direct-link:hover{opacity:1}.post-content img{width:100%;border-radius:.1em}img+em{color:#999}.end-mark{display:flex;align-items:center;justify-content:center;padding:1em 0}.end-mark>img{max-width:3em}</style></head><body class="post-template"><nav class="main-nav"><ul class="nav" role="menu"><li class="nav-item"><a href="/">Posts</a></li><li class="nav-item"><a href="/about/">About</a></li><li class="nav-item"><a href="https://www.chilij.com">Home</a></li></ul></nav><main class="content" role="main"><article class="post"><div class="post-meta"><time datetime="2020-03-08">08 Mar 2020</time></div><h1 class="post-title"><span>Connecting to your AirPods with a shell script (and keyboard shortcut)</span></h1><section class="post-content"><p>Swapping between devices while using AirPods still isn't quite as seamless as it could be, especially when swapping from an iPhone to a Mac, where at the very least you'll be clicking around the menu bar in the sound options, and sometimes even be navigating the bluetooth menu.</p><p>Being able to connect to your AirPods, and then switch your Mac's audio device over programmatically, can save you a lot of clicks if you spend a lot of time in your terminal, and opens up many more opportunities for automation.</p><p>Connecting to your AirPods requires two distinct steps:</p><ul><li>Making sure your AirPods are connected to your Mac via bluetooth</li><li>Once connected, making sure your AirPods are selected as your audio output device</li><li>Optionally: setting a keyboard shortcut to be able to swap devices at any time</li></ul><h2 id="the-requirements">The Requirements <a class="direct-link" href="#the-requirements">ðŸ”—</a></h2><p>You'll need to install two packages to be able to connect to your AirPods in a shell script:</p><ul><li><a href="https://github.com/lapfelix/BluetoothConnector">bluetoothconnector</a> which allows you to connect to / disconnect from bluetooth devices</li><li><a href="https://github.com/deweller/switchaudio-osx/">switchaudio-osx</a> which allows you to select your Mac's current audio input/output devices</li></ul><p>Both of these can be easily installed using <code>brew</code>:</p><pre class="language-shell"><code class="language-shell">brew <span class="token function">install</span> bluetoothconnector switchaudio-osx</code></pre><h2 id="connecting-via-bluetooth">Connecting via Bluetooth <a class="direct-link" href="#connecting-via-bluetooth">ðŸ”—</a></h2><p>The first step is making sure your AirPods are actually connected to your Mac via bluetooth.</p><p>As far as I can tell, <code>BluetoothConnector</code> doesn't have a great, pipeline-compatible CLI so you have to do a bit of ugly string mangling to connect to your airpods.<br>Here's each step involved, split up with some explanation of each part</p><pre class="language-shell"><code class="language-shell"><span class="token comment"># A device name to `grep` for from the available bluetooth devices</span><br><span class="token assign-left variable">DEVICE_NAME</span><span class="token operator">=</span><span class="token string">"airpods pro"</span><br><br><span class="token comment"># Retrieve the bluetooth physical address for your device</span><br><span class="token assign-left variable">device_address</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>BluetoothConnector <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">' - '</span> <span class="token operator">|</span> <span class="token function">grep</span> -i <span class="token string">"<span class="token variable">$DEVICE_NAME</span>"</span> <span class="token operator">|</span> <span class="token function">cut</span> -d <span class="token string">' '</span> -f <span class="token number">1</span><span class="token variable">`</span></span><br><br><span class="token comment"># Connect to the device by its physical address</span><br>BluetoothConnector --connect <span class="token variable">$device_address</span></code></pre><p>A one-liner which packages this all up:</p><pre class="language-shell"><code class="language-shell">BluetoothConnector --connect <span class="token variable"><span class="token variable">`</span>BluetoothConnector <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">' - '</span> <span class="token operator">|</span> <span class="token function">grep</span> -i <span class="token string">"airpods pro"</span> <span class="token operator">|</span> <span class="token function">cut</span> -d <span class="token string">' '</span> -f <span class="token number">1</span><span class="token variable">`</span></span></code></pre><h2 id="selecting-the-audio-output-device">Selecting the audio output device <a class="direct-link" href="#selecting-the-audio-output-device">ðŸ”—</a></h2><p>Once your AirPods are connected via bluetooth, they must be set as your current audio output device.</p><p>If you know the <em>exact</em> name of your AirPods, it's pretty straightforward to set them as your default audio device.</p><pre class="language-shell"><code class="language-shell">SwitchAudioSource -s <span class="token string">"Chiliâ€™s AirPods Pro"</span></code></pre><blockquote><p>By default, AirPods are named with a <strong>right single quotation mark</strong>, not an apostrophe. You should avoid typing out the name by hand, and instead copy the name from the output of <code>SwitchAudioSource -a</code></p></blockquote><p>Similarly, <code>switchaudio-osx</code> doesn't seem to have a pipeline-friendly CLI, so more string-mangling is in order here:</p><pre class="language-shell"><code class="language-shell"><span class="token assign-left variable">DEVICE_NAME</span><span class="token operator">=</span><span class="token string">"airpods pro"</span><br><br><span class="token comment"># Resolve the full audio device name by matching available devices using $DEVICE_NAME</span><br><span class="token assign-left variable">full_audio_device_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>SwitchAudioSource -a -t output <span class="token operator">|</span> <span class="token function">grep</span> -i <span class="token string">"<span class="token variable">$DEVICE_NAME</span>"</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/ (.*//'</span><span class="token variable">`</span></span><br><br><span class="token comment"># Set the default audio output device</span><br>SwitchAudioSource -s <span class="token string">"<span class="token variable">$full_audio_device_name</span>"</span></code></pre><p>Another one-liner that wraps this all up:</p><pre class="language-shell"><code class="language-shell">SwitchAudioSource -s <span class="token string">"$(SwitchAudioSource -a -t output | grep -i 'airpods pro' | sed 's/ (.*//')"</span></code></pre><h2 id="putting-it-all-together">Putting it all together <a class="direct-link" href="#putting-it-all-together">ðŸ”—</a></h2><p>Here is a script I use which combines both the Bluetooth connection steps and output device selection.</p><p>When invoked multiple times, this script will swap between using AirPods and another audio device by default (in this case <code>MacBook Pro Speakers</code>):</p><pre class="language-shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash -xe</span><br><br><span class="token assign-left variable">TARGET_DEVICE_NAME</span><span class="token operator">=</span><span class="token string">"airpods pro"</span><br><span class="token assign-left variable">DEFAULT_AUDIO_DEVICE</span><span class="token operator">=</span><span class="token string">"MacBook Pro Speakers"</span><br><br><span class="token comment"># Connect via Bluetooth</span><br><span class="token assign-left variable">device_address</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>BluetoothConnector <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">' - '</span> <span class="token operator">|</span> <span class="token function">grep</span> -i <span class="token string">"<span class="token variable">$TARGET_DEVICE_NAME</span>"</span> <span class="token operator">|</span> <span class="token function">cut</span> -d <span class="token string">' '</span> -f <span class="token number">1</span><span class="token variable">`</span></span><br>BluetoothConnector --connect <span class="token variable">$device_address</span><br><br><span class="token assign-left variable">target_audio_device</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>SwitchAudioSource -a -t output <span class="token operator">|</span> <span class="token function">grep</span> -i <span class="token string">"<span class="token variable">$TARGET_DEVICE_NAME</span>"</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/ (.*//'</span><span class="token variable">`</span></span><br><span class="token assign-left variable">current_audio_device</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>SwitchAudioSource -c<span class="token variable">`</span></span><br><br><span class="token comment"># Only toggle between devices when the target device is available</span><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token string">"<span class="token variable">$target_audio_device</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$current_audio_device</span>"</span> <span class="token operator">!=</span> <span class="token string">"<span class="token variable">$target_audio_device</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><br>    SwitchAudioSource -s <span class="token string">"<span class="token variable">$target_audio_device</span>"</span><br>  <span class="token keyword">else</span><br>    SwitchAudioSource -s <span class="token string">"<span class="token variable">$DEFAULT_AUDIO_DEVICE</span>"</span><br>  <span class="token keyword">fi</span><br><br><span class="token keyword">fi</span></code></pre><h2 id="bonus%3A-do-it-all-with-a-keyboard-shortcut">Bonus: do it all with a keyboard shortcut <a class="direct-link" href="#bonus%3A-do-it-all-with-a-keyboard-shortcut">ðŸ”—</a></h2><p>Once you've saved this shell script somewhere you can invoke it whenever you need from your terminal, but even better is being able to invoke it at any time, from any app.</p><p>To do this you can use a surprisingly-refined (despite its terrible name), little utility: <a href="https://github.com/deseven/icanhazshortcut/">ICanHazShortcut</a>. Also conveniently available via <code>brew</code>:</p><pre class="language-shell"><code class="language-shell">brew cask <span class="token function">install</span> icanhazshortcut</code></pre><p>Once installed you can run the app and add any keyboard shortcut pointed at the shell script from the previous session. I happen to use <code>Shift+Cmd+Home</code> as my shortcut.</p><h2 id="automate-your-'pods">Automate your 'Pods <a class="direct-link" href="#automate-your-'pods">ðŸ”—</a></h2><p>That's all that's involved with connecting to, and using your AirPods from the command-line. Now that you can control your audio devices using scripts, a whole new area of automation opens up; like connecting to your AirPods automatically whenever you open a music app, or showing notifications when your bluetooth audio devices become available.</p></section></article><footer><div class="end-mark"><img src="/images/lambda.svg" alt="End Mark"></div></footer></main></body></html>